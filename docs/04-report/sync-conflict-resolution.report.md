# [Report] 실시간 동기화 충돌 해결 및 데이터 병합 (v3.7)

## 1. 프로젝트 개요
- **목표**: 여러 기기 사용 시 발생하는 데이터 덮어쓰기 및 동기화 충돌 문제 해결.
- **결과**: 낙관적 잠금, 실시간 동기화 감지, 지능형 데이터 병합 기능 구현 완료.

## 2. 구현 내용
### 2.1 충돌 방지 및 감지
- **낙관적 잠금 (Optimistic Locking)**: 업로드 전 서버의 `updated_at`을 확인하여 로컬의 `lastSyncTime`보다 최신일 경우 업로드를 중단하고 사용자에게 알림.
- **실시간 채널 (Supabase Realtime)**: 다른 기기에서 업로드 발생 시 즉시 감지하여 2분 주기 폴링의 간극을 메움.

### 2.2 충돌 해결 및 병합
- **지능형 병합 (Smart Merge)**: 로컬과 클라우드 데이터를 학급/학생/기록/할 일 단위로 비교하여 병합. 특히 동일 날짜의 일지 충돌 시 내용의 풍부함(길이 등)을 기준으로 자동 선택하는 휴리스틱 적용.
- **SyncConflictModal**: 충돌 상황을 시각화하고 사용자에게 '병합', '복구', '강제 업로드'의 선택권을 제공.

### 2.3 UI/UX 개선
- **Button 컴포넌트 확장**: `fullWidth` 및 `danger` 변체 추가로 모달 UI의 표현력 강화.
- **Toast 알림**: 동기화 상태 및 충돌 발생을 즉각적으로 피드백.

## 3. 검증 결과
- [x] 다른 기기에서 저장 후 현재 기기에서 자동 저장이 차단되는가? - **Pass**
- [x] 실시간 채널을 통해 다른 기기의 변경 사항이 즉시 감지되는가? - **Pass**
- [x] 서로 다른 날짜의 일지를 썼을 때 병합 후 두 데이터가 모두 보존되는가? - **Pass**
- [x] 빌드 및 타입 체크 정상 여부 - **Pass**

## 4. 향후 과제
- **레코드 단위 타임스탬프**: 현재는 데이터 전체가 하나의 블롭으로 저장되나, 각 일지 레코드에 `updated_at`을 추가하면 더 정교한 병합이 가능함.
- **필드 단위 병합**: 동일한 날짜의 일지라도 출석부와 수업 기록을 나누어 병합하는 기능 고도화 고려.
